(()=>{"use strict";var e=Object.defineProperty,t=(t,n,s)=>(((t,n,s)=>{n in t?e(t,n,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[n]=s})(t,"symbol"!=typeof n?n+"":n,s),s);class n{constructor(e){t(this,"map"),t(this,"max"),t(this,"ttl"),t(this,"now"),this.max=Math.max(1,0|e.max),this.ttl=e.ttl,this.now=e.now||Date.now,this.map=new Map}get(e){const t=this.map.get(e);if(t)return null!=t.expiresAt&&t.expiresAt<=this.now()?void this.map.delete(e):(this.map.delete(e),this.map.set(e,t),t.value)}set(e,t){const n=this.ttl?this.now()+this.ttl:null;if(this.map.has(e)&&this.map.delete(e),this.map.set(e,{value:t,expiresAt:n}),this.map.size>this.max){const e=this.map.keys().next();e.done||this.map.delete(e.value)}}has(e){return void 0!==this.get(e)}size(){return this.map.size}clear(){this.map.clear()}}const s=()=>{const e=function(e){"string"==typeof e&&(e={url:e,method:"GET"});const{url:t,method:n="GET",data:s,headers:a={},timeout:r=0,params:i,responseType:o="json",baseURL:l="",validateStatus:c=(e=>e>=200&&e<300)}=e;let h=l?l+t:t;if(i){const e=new URLSearchParams(i);h+=(h.includes("?")?"&":"?")+e.toString()}const u={method:n.toUpperCase(),headers:new Headers(a)};if(s&&!["GET","HEAD"].includes(u.method))if("string"==typeof s)u.body=s;else if(s instanceof FormData)u.body=s;else if(s instanceof URLSearchParams){u.body=s;const e=u.headers;e.get("content-type")||e.set("content-type","application/x-www-form-urlencoded")}else if(s instanceof ArrayBuffer||s instanceof Uint8Array)u.body=s;else{u.body=JSON.stringify(s);const e=u.headers;e.get("content-type")||e.set("content-type","application/json")}const d=new AbortController;u.signal=d.signal;let m=null;return r>0&&(m=setTimeout((()=>d.abort()),r)),fetch(h,u).then((t=>{let n;switch(m&&clearTimeout(m),o){case"text":n=t.text();break;case"blob":n=t.blob();break;case"arraybuffer":n=t.arrayBuffer();break;default:n=t.text().then((e=>{try{return e?JSON.parse(e):{}}catch{return e}}))}return n.then((n=>{const s={},a=t.headers;a&&"function"==typeof a.forEach&&a.forEach(((e,t)=>{s[t]=e}));const r={data:n,status:t.status,statusText:t.statusText,headers:s,config:e,request:{}};if(!c(t.status)){const n=new Error(`Request failed with status ${t.status}`);throw n.config=e,n.response=r,n.code=t.status>=500?"ECONNABORTED":"ERR_BAD_REQUEST",n}return r}))})).catch((t=>{if(m&&clearTimeout(m),"AbortError"===t.name){const t=new Error(`Request timeout after ${r}ms`);throw t.config=e,t.code="ECONNABORTED",{errorType:"NET_ERR",errorCode:0,errorMsg:t.message}}throw t.response?{errorType:"NET_ERR",errorCode:t.response.status||0,errorMsg:t.message||"Request failed"}:{errorType:"NET_ERR",errorCode:0,errorMsg:t.message||"Network Error"}}))};return e.get=(t,n={})=>e({...n,url:t,method:"GET"}),e.post=(t,n,s={})=>e({...s,url:t,data:n,method:"POST"}),e.put=(t,n,s={})=>e({...s,url:t,data:n,method:"PUT"}),e.patch=(t,n,s={})=>e({...s,url:t,data:n,method:"PATCH"}),e.delete=(t,n={})=>e({...n,url:t,method:"DELETE"}),e.head=(t,n={})=>e({...n,url:t,method:"HEAD"}),e.options=(t,n={})=>e({...n,url:t,method:"OPTIONS"}),e.defaults={headers:{common:{Connection:"keep-alive","Keep-Alive":"timeout=30, max=100"},get:{Accept:"application/json, text/plain, */*"},post:{"Content-Type":"application/json",Accept:"application/json, text/plain, */*"},put:{"Content-Type":"application/json",Accept:"application/json, text/plain, */*"},patch:{"Content-Type":"application/json",Accept:"application/json, text/plain, */*"}},timeout:6e3,responseType:"json",baseURL:"",validateStatus:e=>e>=200&&e<300},e.interceptors={request:{use:()=>{},eject:()=>{}},response:{use:()=>{},eject:()=>{}}},e.create=(e={})=>{const t=s();return Object.assign(t.defaults,e),t},e.isAxiosError=e=>e&&("NET_ERR"===e.errorType||e.config&&e.code),e},a=s(),r=a;class i{constructor(){t(this,"IG",""),t(this,"IID",""),t(this,"token",""),t(this,"key",""),t(this,"tokensInitiated",!1),t(this,"tokenInitPromise",null),t(this,"cache"),t(this,"warmupInProgress",!1),t(this,"TTS_AUTH",{region:"",token:""}),t(this,"count",0),t(this,"lastRequestTime",0),t(this,"REQUEST_DELAY",50),t(this,"HTMLParser",new DOMParser),t(this,"MAX_RETRY",1),t(this,"HOST","https://www.bing.com/"),t(this,"HOME_PAGE","https://www.bing.com/translator"),t(this,"HEADERS",{accept:"application/json, text/plain, */*","accept-language":"en-US,en;q=0.9,ko;q=0.8,zh-CN;q=0.7,zh;q=0.6","content-type":"application/x-www-form-urlencoded","user-agent":"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36 Edg/120.0.0.0","accept-encoding":"gzip, deflate, br","cache-control":"no-cache",origin:"https://www.bing.com",referer:"https://www.bing.com/translator","sec-ch-ua":'"Not_A Brand";v="8", "Chromium";v="120", "Microsoft Edge";v="120"',"sec-ch-ua-mobile":"?0","sec-ch-ua-platform":'"macOS"',"sec-fetch-dest":"empty","sec-fetch-mode":"cors","sec-fetch-site":"same-origin"}),t(this,"LANGUAGES",[["auto","auto-detect"],["ar","ar"],["ga","ga"],["et","et"],["or","or"],["bg","bg"],["is","is"],["pl","pl"],["bs","bs-Latn"],["fa","fa"],["prs","prs"],["da","da"],["de","de"],["ru","ru"],["fr","fr"],["zh-TW","zh-Hant"],["fil","fil"],["fj","fj"],["fi","fi"],["gu","gu"],["kk","kk"],["ht","ht"],["ko","ko"],["nl","nl"],["ca","ca"],["zh-CN","zh-Hans"],["cs","cs"],["kn","kn"],["otq","otq"],["tlh","tlh"],["hr","hr"],["lv","lv"],["lt","lt"],["ro","ro"],["mg","mg"],["mt","mt"],["mr","mr"],["ml","ml"],["ms","ms"],["mi","mi"],["bn","bn-BD"],["hmn","mww"],["af","af"],["pa","pa"],["pt","pt"],["ps","ps"],["ja","ja"],["sv","sv"],["sm","sm"],["sr-Latn","sr-Latn"],["sr-Cyrl","sr-Cyrl"],["no","nb"],["sk","sk"],["sl","sl"],["sw","sw"],["ty","ty"],["te","te"],["ta","ta"],["th","th"],["to","to"],["tr","tr"],["cy","cy"],["ur","ur"],["uk","uk"],["es","es"],["he","iw"],["el","el"],["hu","hu"],["it","it"],["hi","hi"],["id","id"],["en","en"],["yua","yua"],["yue","yua"],["vi","vi"],["ku","ku"],["kmr","kmr"]]),t(this,"READERS",{ar:["ar-SA","Male","ar-SA-Naayf"],bg:["bg-BG","Male","bg-BG-Ivan"],ca:["ca-ES","Female","ca-ES-HerenaRUS"],cs:["cs-CZ","Male","cs-CZ-Jakub"],da:["da-DK","Female","da-DK-HelleRUS"],de:["de-DE","Female","de-DE-Hedda"],el:["el-GR","Male","el-GR-Stefanos"],en:["en-US","Female","en-US-JessaRUS"],es:["es-ES","Female","es-ES-Laura-Apollo"],fi:["fi-FI","Female","fi-FI-HeidiRUS"],fr:["fr-FR","Female","fr-FR-Julie-Apollo"],he:["he-IL","Male","he-IL-Asaf"],hi:["hi-IN","Female","hi-IN-Kalpana-Apollo"],hr:["hr-HR","Male","hr-HR-Matej"],hu:["hu-HU","Male","hu-HU-Szabolcs"],id:["id-ID","Male","id-ID-Andika"],it:["it-IT","Male","it-IT-Cosimo-Apollo"],ja:["ja-JP","Female","ja-JP-Ayumi-Apollo"],ko:["ko-KR","Female","ko-KR-HeamiRUS"],ms:["ms-MY","Male","ms-MY-Rizwan"],nl:["nl-NL","Female","nl-NL-HannaRUS"],nb:["nb-NO","Female","nb-NO-HuldaRUS"],no:["nb-NO","Female","nb-NO-HuldaRUS"],pl:["pl-PL","Female","pl-PL-PaulinaRUS"],pt:["pt-PT","Female","pt-PT-HeliaRUS"],ro:["ro-RO","Male","ro-RO-Andrei"],ru:["ru-RU","Female","ru-RU-Irina-Apollo"],sk:["sk-SK","Male","sk-SK-Filip"],sl:["sl-SL","Male","sl-SI-Lado"],sv:["sv-SE","Female","sv-SE-HedvigRUS"],ta:["ta-IN","Female","ta-IN-Valluvar"],te:["te-IN","Male","te-IN-Chitra"],th:["th-TH","Male","th-TH-Pattara"],tr:["tr-TR","Female","tr-TR-SedaRUS"],vi:["vi-VN","Male","vi-VN-An"],"zh-Hans":["zh-CN","Female","zh-CN-HuihuiRUS"],"zh-Hant":["zh-CN","Female","zh-CN-HuihuiRUS"],yue:["zh-HK","Female","zh-HK-TracyRUS"]}),t(this,"TTS_LAN_CODE",{ar:"ar-EG",ca:"ca-ES",da:"da-DK",de:"de-DE",en:"en-US",es:"es-ES",fi:"fi-FI",fr:"fr-FR",hi:"hi-IN",it:"it-IT",ja:"ja-JP",ko:"ko-KR",nb:"nb-NO",nl:"nl-NL",pl:"pl-PL",pt:"pt-PT",ru:"ru-RU",sv:"sv-SE",th:"th-TH","zh-Hans":"zh-CN","zh-Hant":"zh-HK",yue:"zh-HK",gu:"gu-IN",mr:"mr-IN",ta:"ta-IN",te:"te-IN",tr:"tr-TR"}),t(this,"LAN_TO_CODE",new Map(this.LANGUAGES)),t(this,"CODE_TO_LAN",new Map(this.LANGUAGES.map((([e,t])=>[t,e])))),t(this,"AUDIO",new Audio),this.cache=new n({max:100,ttl:6e5}),this.loadCachedTokens(),setTimeout((()=>this.warmUp().catch((()=>{}))),0)}async updateTokens(){if(this.tokenInitPromise)await this.tokenInitPromise;else{this.tokenInitPromise=this._doUpdateTokens();try{await this.tokenInitPromise}finally{this.tokenInitPromise=null}}}loadCachedTokens(){try{if(typeof localStorage>"u")return!1;const e=localStorage.getItem("bing_translator_tokens");if(!e)return!1;const{IG:t,token:n,key:s,IID:a,HOST:r,timestamp:i}=JSON.parse(e);if(Date.now()-i<18e5)return this.IG=t,this.token=n,this.key=s,this.IID=a||"",this.HOST=r||"https://www.bing.com/",this.HOME_PAGE=`${this.HOST}translator`,this.tokensInitiated=!0,!0;localStorage.removeItem("bing_translator_tokens")}catch{}return!1}cacheTokens(){try{if(typeof localStorage>"u")return;const e={IG:this.IG,token:this.token,key:this.key,IID:this.IID,HOST:this.HOST,timestamp:Date.now()};localStorage.setItem("bing_translator_tokens",JSON.stringify(e))}catch{}}async warmUp(){if(!this.tokensInitiated&&!this.warmupInProgress){this.warmupInProgress=!0;try{await this.updateTokens()}catch(e){console.debug("Bing translator warmup failed:",e)}finally{this.warmupInProgress=!1}}}async _doUpdateTokens(){const e=await r.get(this.HOME_PAGE,{timeout:5e3}),t=/(https:\/\/.*\.bing\.com\/).*/g.exec(e.request.responseURL);t&&t[1]!=this.HOST&&(this.HOST=t[1],this.HOME_PAGE=`${this.HOST}translator`);const n=e.data.match(/IG:"([A-Za-z0-9]+)"/);if(!n)throw new Error("Failed to extract IG token");this.IG=n[1];const s=e.data.match(/var params_AbusePreventionHelper\s*=\s*\[([0-9]+),\s*"([^"]+)",[^\]]*\];/);if(!s)throw new Error("Failed to extract abuse prevention params");[,this.key,this.token]=s;const a=e.data.match(/data-iid="([^"]+)"/);this.IID=a?a[1]:"",this.count=0,this.cacheTokens()}extractTextFromTranslateResponse(e){var t,n,s;try{if(Array.isArray(e))return e.map((e=>{var t,n;return(null==(n=null==(t=null==e?void 0:e.translations)?void 0:t[0])?void 0:n.text)||""})).filter(Boolean).join("");if(e&&e[0])return(null==(s=null==(n=null==(t=e[0])?void 0:t.translations)?void 0:n[0])?void 0:s.text)||""}catch{}return""}async segmentAndTranslate(e,t,n){const s=async e=>{const s=await this.request(this.constructTranslateParams,[e,t,n]),a=this.extractTextFromTranslateResponse(s);if(a)return a;await this.updateTokens();const r=await this.request(this.constructTranslateParams,[e,t,n]);return this.extractTextFromTranslateResponse(r)};try{const t=await s(e);if(t)return t}catch{}const a=e.split(/\n{2,}/).filter((e=>e.length>0));if(a.length>1){const e=[];for(const s of a){const a=await this.segmentAndTranslate(s,t,n);e.push(a)}return e.join("\n\n")}const r=e.split(/(?<=[.!?。！？])\s+/).filter(Boolean);if(r.length>1){const e=[];for(const s of r){const a=await this.segmentAndTranslate(s,t,n);e.push(a)}return e.join(" ")}const i=e.split(/[,;:、，；：]\s*/).filter(Boolean);if(i.length>1){const e=[];for(const s of i){const a=await this.segmentAndTranslate(s,t,n);e.push(a)}return e.join(" ")}const o=e.split(/\s+/).filter(Boolean);if(o.length>1){const e=[];for(const s of o){const a=await this.segmentAndTranslate(s,t,n);e.push(a)}return e.join(" ")}try{return await s(e)}catch{return""}}parseTranslateResult(e,t){const n=t||new Object;try{const t=e[0].translations;n.mainMeaning=t[0].text,n.tPronunciation=t[0].transliteration.text}catch{}return n}parseLookupResult(e,t){const n=t||new Object;try{n.originalText=e[0].displaySource;const t=e[0].translations;n.mainMeaning=t[0].displayTarget,n.tPronunciation=t[0].transliteration;const s=[],a=[];for(const e in t){const n=[];for(const s in t[e].backTranslations)n.push(t[e].backTranslations[s].displayText);if(s.push({pos:t[e].posTag,meaning:t[e].displayTarget,synonyms:n}),t[e].examples&&t[e].examples.length>0)for(const n of t[e].examples)a.push({pos:t[e].posTag,meaning:t[e].displayTarget,example:n.sourceExample||n.targetExample})}if(n.detailedMeanings=s,a.length>0&&(n.definitions=a),e[0].examples&&e[0].examples.length>0){const t=[];for(const n of e[0].examples)t.push({source:n.sourcePrefix+n.sourceTerm+n.sourceSuffix,target:n.targetPrefix+n.targetTerm+n.targetSuffix});n.examples=t}}catch{}return n}parseExampleResult(e,t){const n=t||new Object;try{n.examples=e[0].examples.map((e=>({source:`${e.sourcePrefix}<b>${e.sourceTerm}</b>${e.sourceSuffix}`,target:`${e.targetPrefix}<b>${e.targetTerm}</b>${e.targetSuffix}`})))}catch{}return n}async updateTTSAuth(){const e=await this.request((()=>({method:"POST",baseURL:this.HOST,url:`tfetspktok?isVertical=1&&IG=${this.IG}&IID=${this.IID}.${this.count.toString()}`,headers:this.HEADERS,data:`&token=${encodeURIComponent(this.token)}&key=${encodeURIComponent(this.key)}`})),[]);this.TTS_AUTH.region=e.region,this.TTS_AUTH.token=e.token}generateTTSData(e,t,n){const s=this.LAN_TO_CODE.get(t),a=this.READERS[s],r=this.TTS_LAN_CODE[s],i="fast"===n?"-10.00%":"-30.00%";return`<speak version='1.0' xml:lang='${r}'><voice xml:lang='${r}' xml:gender='${a[1]}' name='${a[2]}'><prosody rate='${i}'>${e}</prosody></voice></speak>`}arrayBufferToBase64(e){let t="",n=new Uint8Array(e);for(let e=0;e<n.byteLength;e++)t+=String.fromCharCode(n[e]);return btoa(t)}constructDetectParams(e){const t=`ttranslatev3?isVertical=1&IG=${this.IG}&IID=${this.IID}.${this.count.toString()}`,n=`&fromLang=auto-detect&to=zh-Hans&text=${encodeURIComponent(e)}&token=${encodeURIComponent(this.token)}&key=${encodeURIComponent(this.key)}`;return{method:"POST",baseURL:this.HOST,url:t,headers:this.HEADERS,data:n}}constructTranslateParams(e,t,n){const s=`ttranslatev3?isVertical=1&IG=${this.IG}&IID=${this.IID}.${this.count.toString()}`,a=`&fromLang=${this.LAN_TO_CODE.get(t)}&to=${this.LAN_TO_CODE.get(n)}&text=${encodeURIComponent(e)}&token=${encodeURIComponent(this.token)}&key=${encodeURIComponent(this.key)}`;return{method:"POST",baseURL:this.HOST,url:s,headers:this.HEADERS,data:a}}constructLookupParams(e,t,n){const s=`tlookupv3?isVertical=1&IG=${this.IG}&IID=${this.IID}.${this.count.toString()}`,a=`&from=${t}&to=${this.LAN_TO_CODE.get(n)}&text=${encodeURIComponent(e)}&token=${encodeURIComponent(this.token)}&key=${encodeURIComponent(this.key)}`;return{method:"POST",baseURL:this.HOST,url:s,headers:this.HEADERS,data:a}}constructExampleParams(e,t,n,s){const a=`texamplev3?isVertical=1&IG=${this.IG}&IID=${this.IID}.${this.count.toString()}`,r=`&from=${e}&to=${this.LAN_TO_CODE.get(t)}&text=${encodeURIComponent(n)}&translation=${encodeURIComponent(s)}&token=${encodeURIComponent(this.token)}&key=${encodeURIComponent(this.key)}`;return{method:"POST",baseURL:this.HOST,url:a,headers:this.HEADERS,data:r}}constructTTSParams(e,t,n){return{method:"POST",baseURL:`https://${this.TTS_AUTH.region}.tts.speech.microsoft.com/cognitiveservices/v1?`,headers:{"Content-Type":"application/ssml+xml",Authorization:`Bearer ${this.TTS_AUTH.token}`,"X-MICROSOFT-OutputFormat":"audio-16khz-32kbitrate-mono-mp3","cache-control":"no-cache"},data:this.generateTTSData(e,t,n),responseType:"arraybuffer"}}async request(e,t,n=!0){const s=Date.now()-this.lastRequestTime;if(s<this.REQUEST_DELAY&&this.count>5){const e=this.REQUEST_DELAY-s;await new Promise((t=>setTimeout(t,e)))}this.lastRequestTime=Date.now();let a=0;const i=async()=>{this.count++;try{return await r({timeout:8e3,...e.call(this,...t)})}catch(e){throw e}},o=async e=>{if(401===e.status||429===e.status)throw{errorType:"API_ERR",errorCode:e.status,errorMsg:"Request too frequently!"};const t=/(https:\/\/.*\.bing\.com\/).*/g.exec(e.request.responseURL);if(t&&t[1]!==this.HOST)return this.HOST=t[1],this.HOME_PAGE=`${this.HOST}translator`,await this.updateTokens().then(i);const s=e.headers&&(e.headers["content-type"]||e.headers["Content-Type"])||"";if("string"==typeof e.data){const t=e.data;if(/text\/html/i.test(s)||/<html|<!DOCTYPE/i.test(t)){if(n&&a<this.MAX_RETRY+1)return a++,await this.updateTokens(),await i().then(o);throw{errorType:"API_ERR",errorCode:200,errorMsg:"Unexpected HTML response from Bing"}}}const r=e.data.StatusCode||e.data.statusCode||200;switch(r){case 200:return e.data;case 205:return await this.updateTokens().then(i)}if(n&&a<this.MAX_RETRY)return a++,await this.updateTokens().then(i);throw{errorType:"API_ERR",errorCode:r,errorMsg:"Request failed."}};return await(async()=>{this.tokensInitiated||(await this.updateTokens(),this.tokensInitiated=!0)})(),(async()=>{const e=await i();return await o(e)})()}supportedLanguages(){return new Set(this.LAN_TO_CODE.keys())}async detect(e){try{const t=(await this.request(this.constructDetectParams,[e]))[0].detectedLanguage.language;return this.CODE_TO_LAN.get(t)}catch(t){throw t.errorMsg=t.errorMsg||t.message,t.errorAct={api:"bing",action:"detect",text:e,from:null,to:null},t}}async translate(e,t,n,s=!1){var a,r;if(!e||!e.trim())return{originalText:e||"",mainMeaning:""};const i=`${t}|${n}|${e.toLowerCase().trim()}`,o=this.cache.get(i);if(o)return o;const l={text:e,from:t,to:n};let c;try{c=await this.request(this.constructTranslateParams,[e,t,n])}catch(s){throw s.errorAct={api:"bing",action:"translate",text:e,from:t,to:n},s}const h=this.parseTranslateResult(c,{originalText:e,mainMeaning:""});if(!h.mainMeaning&&!s)try{const s=await this.segmentAndTranslate(e,t,n);if(s){let t=l.from;if("auto"===l.from)try{const n=await this.detect(e);t=n&&"auto"!==n?n:"en"}catch{t="en"}const n={originalText:l.text,mainMeaning:s,sourceLanguage:t,targetLanguage:l.to};return this.cache.set(i,n),n}}catch{}try{const s=null==(r=null==(a=c[0])?void 0:a.detectedLanguage)?void 0:r.language;if(!s)throw new Error("Failed to detect language from response");h.sourceLanguage=t,h.targetLanguage=n;const[o,l]=await Promise.allSettled([this.request(this.constructLookupParams,[e,s,n],!1).then((e=>({type:"lookup",response:e}))),h.mainMeaning?this.request(this.constructExampleParams,[s,n,e,h.mainMeaning],!1).then((e=>({type:"example",response:e}))):Promise.reject("No main meaning")]);let u=h;return"fulfilled"===o.status&&(u=this.parseLookupResult(o.value.response,u)),"fulfilled"===l.status&&(u=this.parseExampleResult(l.value.response,u)),this.cache.set(i,u),u}catch{return h.sourceLanguage=t,h.targetLanguage=n,this.cache.set(i,h),h}}async pronounce(e,t,n){this.stopPronounce();let s=t;if("auto"===t)try{const t=await this.detect(e);s=t&&"auto"!==t?t:"en"}catch{s="en"}const a=this.LAN_TO_CODE.get(s),r=this.READERS;if(!a||!r[a])throw{errorType:"LANG_ERR",errorCode:0,errorMsg:`Language '${s}' is not supported for TTS`,errorAct:{api:"bing",action:"pronounce",text:e,from:s,to:null}};let i=0;const o=async()=>{try{const t=await this.request(this.constructTTSParams,[e,s,n],!1);this.AUDIO.src=`data:audio/mp3;base64,${this.arrayBufferToBase64(t)}`,await this.AUDIO.play()}catch(t){if(i<this.MAX_RETRY)return i++,this.updateTTSAuth().then(o);const n={api:"bing",action:"pronounce",text:e,from:s,to:null};throw t.errorType?(t.errorAct=n,t):{errorType:"NET_ERR",errorCode:0,errorMsg:t.message,errorAct:n}}};return this.TTS_AUTH.region.length>0&&this.TTS_AUTH.token.length>0||await this.updateTTSAuth(),o()}stopPronounce(){this.AUDIO.paused||this.AUDIO.pause()}getCacheStats(){return{size:this.cache.size(),maxSize:100,ttl:6e5}}async cleanup(){this.cache.clear()}}function o(e){let t=2166136261;for(let n=0;n<e.length;n++)t^=e.charCodeAt(n),t=(t<<1)+(t<<4)+(t<<7)+(t<<8)+(t<<24)+(t>>>0);return(t>>>0).toString(16)}const l=[["auto","auto"],["zh-CN","zh-CN"],["zh-TW","zh-TW"],["en","en"],["af","af"],["am","am"],["ar","ar"],["az","az"],["be","be"],["bg","bg"],["bn","bn"],["bs","bs"],["ca","ca"],["ceb","ceb"],["co","co"],["cs","cs"],["cy","cy"],["da","da"],["de","de"],["el","el"],["eo","eo"],["es","es"],["et","et"],["eu","eu"],["fa","fa"],["fi","fi"],["fr","fr"],["fy","fy"],["ga","ga"],["gd","gd"],["gl","gl"],["gu","gu"],["ha","ha"],["haw","haw"],["he","he"],["hi","hi"],["hmn","hmn"],["hr","hr"],["ht","ht"],["hu","hu"],["hy","hy"],["id","id"],["ig","ig"],["is","is"],["it","it"],["ja","ja"],["jw","jw"],["ka","ka"],["kk","kk"],["km","km"],["kn","kn"],["ko","ko"],["ku","ku"],["ky","ky"],["la","la"],["lb","lb"],["lo","lo"],["lt","lt"],["lv","lv"],["mg","mg"],["mi","mi"],["mk","mk"],["ml","ml"],["mn","mn"],["mr","mr"],["ms","ms"],["mt","mt"],["my","my"],["ne","ne"],["nl","nl"],["no","no"],["ny","ny"],["pl","pl"],["ps","ps"],["pt","pt"],["ro","ro"],["ru","ru"],["sd","sd"],["si","si"],["sk","sk"],["sl","sl"],["sm","sm"],["sn","sn"],["so","so"],["sq","sq"],["sr","sr"],["st","st"],["su","su"],["sv","sv"],["sw","sw"],["ta","ta"],["te","te"],["tg","tg"],["th","th"],["fil","tl"],["tr","tr"],["ug","ug"],["uk","uk"],["ur","ur"],["uz","uz"],["vi","vi"],["xh","xh"],["yi","yi"],["yo","yo"],["zu","zu"]];class c{constructor(){t(this,"TKK",[434217,1534559001]),t(this,"HOME_PAGE","https://translate.google.com/"),t(this,"HOST","https://translate.googleapis.com/"),t(this,"TRANSLATE_URL",`${this.HOST}translate_a/single?client=gtx&dj=1&dt=t&dt=at&dt=bd&dt=ex&dt=md&dt=rw&dt=ss&dt=rm`),t(this,"TTS_URL",`${this.HOST}translate_tts?client=gtx`),t(this,"FALLBACK_TRANSLATE_URL",`${this.HOST}translate_a/single?ie=UTF-8&client=webapp&otf=1&ssel=0&tsel=0&kc=5&dt=t&dt=at&dt=bd&dt=ex&dt=md&dt=rw&dt=ss&dt=rm`),t(this,"FALLBACK_TTS_URL",`${this.HOST}translate_tts?ie=UTF-8&client=webapp`),t(this,"fallBacking",!1),t(this,"LAN_TO_CODE",new Map(l)),t(this,"CODE_TO_LAN",new Map(l.map((([e,t])=>[t,e])))),t(this,"AUDIO",new Audio),t(this,"cache",new n({max:200,ttl:12e4}))}generateTK(e,t,n){t=Number(t)||0;let s=[],a=0,r=0;for(;r<e.length;r++){let t=e.charCodeAt(r);128>t?s[a++]=t:(2048>t?s[a++]=t>>6|192:(55296==(64512&t)&&r+1<e.length&&56320==(64512&e.charCodeAt(r+1))?(t=65536+((1023&t)<<10)+(1023&e.charCodeAt(++r)),s[a++]=t>>18|240,s[a++]=t>>12&63|128):s[a++]=t>>12|224,s[a++]=t>>6&63|128),s[a++]=63&t|128)}for(e=t,a=0;a<s.length;a++)e+=s[a],e=this._magic(e,"+-a^+6");return e=this._magic(e,"+-3^+b+-f"),0>(e^=Number(n)||0)&&(e=2147483648+(2147483647&e)),(e%=1e6).toString()+"."+(e^t)}_magic(e,t){for(var n=0;n<t.length-2;n+=3){var s="a"<=(s=t.charAt(n+2))?s.charCodeAt(0)-87:Number(s);s="+"==t.charAt(n+1)?e>>>s:e<<s,e="+"==t.charAt(n)?e+s&4294967295:e^s}return e}async updateTKK(){let e=(await a.get(this.HOME_PAGE)).data,t=(e.match(/TKK=(.*?)\(\)\)';/i)||[""])[0].replace(/\\x([0-9A-Fa-f]{2})/g,"").match(/[+-]?\d+/g);t?(this.TKK[0]=Number(t[2]),this.TKK[1]=Number(t[0])+Number(t[1])):(t=e.match(/TKK[=:]['"](\d+?)\.(\d+?)['"]/i),t&&(this.TKK[0]=Number(t[1]),this.TKK[1]=Number(t[2])))}fallBack(){this.fallBacking=!0,setTimeout((()=>{this.fallBacking=!1}),18e5)}generateDetectURL(e){let t="&sl=auto&tl=zh-cn";return t+=`&tk=${this.generateTK(e,this.TKK[0],this.TKK[1])}&q=${encodeURIComponent(e)}`,this.fallBacking?this.FALLBACK_TRANSLATE_URL+t:this.TRANSLATE_URL+t}generateTranslateURL(e,t,n){let s=`&sl=${this.LAN_TO_CODE.get(t)}&tl=${this.LAN_TO_CODE.get(n)}`;return s+=`&tk=${this.generateTK(e,this.TKK[0],this.TKK[1])}&q=${encodeURIComponent(e)}`,this.fallBacking?this.FALLBACK_TRANSLATE_URL+s:this.TRANSLATE_URL+s}parseDetectResult(e){return this.fallBacking?this.CODE_TO_LAN.get(e[2])||"":e.ld_result.extended_srclangs?this.CODE_TO_LAN.get(e.ld_result.extended_srclangs[0])||"":this.CODE_TO_LAN.get(e.ld_result.srclangs[0])||""}parseBetterResult(e){const t={originalText:"",mainMeaning:""};if(e.sentences){t.mainMeaning="",t.originalText="";let n=0;for(;n<e.sentences.length&&e.sentences[n].trans;n++)t.mainMeaning+=e.sentences[n].trans,t.originalText+=e.sentences[n].orig;n<e.sentences.length&&(e.sentences[n].translit&&(t.tPronunciation=e.sentences[n].translit),e.sentences[n].src_translit&&(t.sPronunciation=e.sentences[n].src_translit))}if(e.dict){t.detailedMeanings=[];for(let n of e.dict)for(let e of n.entry)t.detailedMeanings.push({pos:n.pos,meaning:e.word,synonyms:e.reverse_translation})}if(e.definitions){t.definitions=[];for(let n of e.definitions)for(let e of n.entry)t.definitions.push({pos:n.pos,meaning:e.gloss,synonyms:[],example:e.example})}if(e.examples){t.examples=[];for(let n of e.examples.example)t.examples.push({source:n.text,target:null});t.examples.sort(((e,t)=>e.source>t.source?1:e.source===t.source?0:-1))}return t}parseFallbackResult(e){const t={originalText:"",mainMeaning:""};for(let n=0;n<e.length;n++)if(e[n]){const s=e[n];switch(n){case 0:{let e=[],n=[],a=s.length-1;for(let t=0;t<=a;t++)e.push(s[t][0]),n.push(s[t][1]);t.mainMeaning=e.join(""),t.originalText=n.join("");try{a>0&&(s[a][2]&&s[a][2].length>0&&(t.tPronunciation=s[a][2]),s[a][3]&&s[a][3].length>0&&(t.sPronunciation=s[a][3]))}catch{}break}case 1:t.detailedMeanings=new Array,s.forEach((e=>t.detailedMeanings.push({pos:e[0],meaning:e[1].join(", ")})));break;case 12:t.definitions=new Array,s.forEach((e=>{e[1].forEach((n=>{t.definitions.push({pos:e[0],meaning:n[0],example:n[2]})}))}));break;case 13:t.examples=new Array,s.forEach((e=>e.forEach((e=>t.examples.push({source:null,target:e[0]})))))}}return t}parseTranslateResult(e){return this.fallBacking?this.parseFallbackResult(e):this.parseBetterResult(e)}supportedLanguages(){return new Set(this.LAN_TO_CODE.keys())}detect(e){if(!e||!e.trim())return Promise.resolve("");const t=`Gd|${o(e)}`,n=this.cache.get(t);if(n)return Promise.resolve(n);const s=async()=>{const n=await a.get(this.generateDetectURL(e),{validateStatus:e=>e<500,timeout:a.defaults.timeout||8e3});if(200===n.status){const e=this.parseDetectResult(n.data);return this.cache.set(t,e),e}if(429===n.status&&!this.fallBacking)return this.fallBack(),await this.updateTKK().then(s);throw{errorType:"API_ERR",errorCode:n.status,errorMsg:"Detect failed.",errorAct:{api:"google",action:"detect",text:e,from:null,to:null}}};return s()}translate(e,t,n){if(!e||!e.trim())return Promise.resolve({originalText:e||"",mainMeaning:""});const s=`Gt|${t}|${n}|${o(e)}`,r=this.cache.get(s);if(r)return Promise.resolve(r);const i=async()=>{const r=await a.get(this.generateTranslateURL(e,t,n),{validateStatus:e=>e<500,timeout:a.defaults.timeout||8e3});if(200===r.status){let e=this.parseTranslateResult(r.data);return this.cache.set(s,e),e}if(429===r.status&&!this.fallBacking)return this.fallBack(),await this.updateTKK().then(i);throw{errorType:"API_ERR",errorCode:r.status,errorMsg:"Translate failed.",errorAct:{api:"google",action:"translate",text:e,from:t,to:n}}};return i()}async pronounce(e,t,n){this.stopPronounce();let s="fast"===n?"0.8":"0.2";this.AUDIO.src=`${this.fallBacking?this.FALLBACK_TTS_URL:this.TTS_URL}&q=${encodeURIComponent(e)}&tl=${this.LAN_TO_CODE.get(t)}&ttsspeed=${s}&tk=${this.generateTK(e,this.TKK[0],this.TKK[1])}`;try{await this.AUDIO.play()}catch(n){throw{errorType:"NET_ERR",errorCode:0,errorMsg:n.message,errorAct:{api:"google",action:"pronounce",text:e,from:t,to:null}}}}stopPronounce(){this.AUDIO.paused||this.AUDIO.pause()}}const h=[["auto","auto"],["bg","bg"],["et","et"],["pl","pl"],["da","da"],["de","de"],["ru","ru"],["fr","fr"],["fi","fi"],["nl","nl"],["zh-CN","zh"],["cs","cs"],["lv","lv"],["lt","lt"],["ro","ro"],["pt","pt"],["ja","ja"],["sv","sv"],["sk","sk"],["sl","sl"],["es","es"],["el","el"],["hu","hu"],["it","it"],["en","en"]];class u{constructor(e,n){t(this,"HOME_PAGE","https://www.deepl.com/translator"),t(this,"LAN_TO_CODE",new Map(h)),t(this,"CODE_TO_LAN",new Map(h.map((([e,t])=>[t,e])))),t(this,"langDetector"),t(this,"TTSEngine"),t(this,"deepLIframe"),this.langDetector=e,this.TTSEngine=n,this.createIframe()}createIframe(){this.deepLIframe=document.createElement("iframe"),document.body.appendChild(this.deepLIframe),this.deepLIframe.src=this.HOME_PAGE}supportedLanguages(){return new Set(this.LAN_TO_CODE.keys())}async detect(e){return await this.langDetector.detect(e)}async translate(e,t,n){try{return{mainMeaning:await new Promise(((s,a)=>{const r=setTimeout((()=>{a({status:408,errorMsg:"Request timeout!"})}),1e4),i=e=>{!e.data.type||"edge_translate_deepl_response"!==e.data.type||(window.removeEventListener("message",i),clearTimeout(r),200===e.data.status?s(e.data.result):a(e.data))};window.addEventListener("message",i),this.deepLIframe.contentWindow.postMessage({type:"edge_translate_deepl_request",url:`${this.HOME_PAGE}#${this.LAN_TO_CODE.get(t)}/${this.LAN_TO_CODE.get(n)}/${encodeURIComponent(e.replaceAll("/","\\/"))}`},this.HOME_PAGE)})),originalText:e}}catch(s){throw 408===s.status&&(document.body.removeChild(this.deepLIframe),this.createIframe()),s.errorCode=s.status||0,s.errorMsg=s.errorMsg||s.message,s.errorAct={api:"deepl",action:"translate",text:e,from:t,to:n},s}}async pronounce(e,t,n){return await this.TTSEngine.pronounce(e,t,n)}stopPronounce(){this.TTSEngine.stopPronounce()}}class d{constructor(e,s){t(this,"channel"),t(this,"CONFIG",{selections:{},translators:[]}),t(this,"REAL_TRANSLATORS"),t(this,"MAIN_TRANSLATOR","GoogleTranslate"),t(this,"cache",new n({max:250,ttl:9e5})),t(this,"inflight",new Map),t(this,"stats",{requests:0,cacheHits:0,errors:0}),this.channel=s,this.REAL_TRANSLATORS={BingTranslate:new i,GoogleTranslate:new c,DeepLTranslate:null},this.REAL_TRANSLATORS.DeepLTranslate=new u(this.REAL_TRANSLATORS.BingTranslate,this.REAL_TRANSLATORS.BingTranslate),this.useConfig(e),this.warmUpTranslators()}async warmUpTranslators(){setTimeout((()=>{this.REAL_TRANSLATORS.BingTranslate.warmUp().catch((()=>{}))}),100)}useConfig(e){e&&e.translators&&e.selections?(this.CONFIG=e,this.MAIN_TRANSLATOR=e.selections.mainMeaning):console.error("Invalid config for HybridTranslator!")}getAvailableTranslatorsFor(e,t){const n=[];for(const s of Object.keys(this.REAL_TRANSLATORS)){const a=this.REAL_TRANSLATORS[s].supportedLanguages();a.has(e)&&a.has(t)&&n.push(s)}return n.sort(((e,t)=>"GoogleTranslate"===e?-1:"GoogleTranslate"===t?1:e.localeCompare(t)))}updateConfigFor(e,t){const n={translators:[],selections:{}},s=new Set,a=this.getAvailableTranslatorsFor(e,t),r=a[0],i=new Set(a);let o;for(o in this.CONFIG.selections){let e,t=this.CONFIG.selections[o];i.has(t)?(n.selections[o]=t,e=t):(n.selections[o]=r,e=r),s.add(e)}return n.translators=Array.from(s),n}async detect(e){return this.REAL_TRANSLATORS[this.MAIN_TRANSLATOR].detect(e)}hasInCache(e){return this.cache.has(e)}async translateSingle(e,t,n){this.stats.requests++;const s=`${t}|${n}|${e.toLowerCase().trim()}`,a=this.cache.get(s);if(a)return this.stats.cacheHits++,a;let r=[];for(let s of this.CONFIG.translators)r.push(this.REAL_TRANSLATORS[s].translate(e,t,n).then((e=>[s,e])));const i={originalText:"",mainMeaning:""},o=new Map(await Promise.all(r));let l;for(l in this.CONFIG.selections)try{const e=this.CONFIG.selections[l],t=o.get(e);if(t[l]&&this.hasValue(t[l]))i[l]=t[l];else{const e=o.get("GoogleTranslate");e&&e[l]&&this.hasValue(e[l])?i[l]=e[l]:t[l]&&(i[l]=t[l])}}catch(e){console.log(`${l} ${this.CONFIG.selections[l]}`),console.log(e)}return i.originalText||(i.originalText=e),this.cache.set(s,i),i}async translate(e,t,n){if(!e||!e.trim())return{originalText:e||"",mainMeaning:""};const s=`H|${t}|${n}|${o(e)}`,a=this.cache.get(s);if(a)return this.stats.cacheHits++,a;const r=this.inflight.get(s);if(r)return r;const i=(async()=>{try{const s=await this.translateSingle(e,t,n);return this.stats.requests++,s}catch(e){throw this.stats.errors++,e}})();this.inflight.set(s,i);try{return await i}finally{this.inflight.delete(s)}}async pronounce(e,t,n){return await this.REAL_TRANSLATORS[this.MAIN_TRANSLATOR].pronounce(e,t,n)}async stopPronounce(){this.REAL_TRANSLATORS[this.MAIN_TRANSLATOR].stopPronounce()}getCacheStats(){return{size:this.cache.size(),maxSize:250,ttl:9e5}}getPerformanceStats(){var e;const t=this.getCacheStats(),n={...this.stats,cacheSize:t.size,maxCacheSize:t.maxSize,cacheTTL:t.ttl,hitRate:this.stats.requests>0?(this.stats.cacheHits/this.stats.requests*100).toFixed(1)+"%":"0%",inflight:this.inflight.size};return null!=(e=this.REAL_TRANSLATORS.BingTranslate)&&e.getCacheStats&&(n.bing=this.REAL_TRANSLATORS.BingTranslate.getCacheStats()),n}async cleanup(){var e;this.cache.clear(),this.inflight.clear(),null!=(e=this.REAL_TRANSLATORS.BingTranslate)&&e.cleanup&&await this.REAL_TRANSLATORS.BingTranslate.cleanup()}hasValue(e){return null!=e&&("string"==typeof e?e.trim().length>0:Array.isArray(e)?e.length>0:"object"!=typeof e||Object.keys(e).length>0)}}const m=new Set(["Unable to download","Unable to download all specified images","Image loading failed","Cannot access","before initialization","Extension context invalidated","Canvas error","Network error"]),g=[/Cannot access '.*' before initialization/i,/ReferenceError.*before initialization/i,/Unable to download.*images/i];function f(e){if(!e)return!1;let t="";try{t="string"==typeof e?e:(null==e?void 0:e.message)||String(e)}catch(e){t=""}try{return Array.from(m).some((e=>t&&"string"==typeof t&&t.includes(e)))||g.some((e=>{try{return e.test(t)}catch(e){return!1}}))}catch(e){return!1}}const p={debug:10,info:20,warn:30,error:40,silent:90};function T(e){return p[e]>=p.warn}function y(...e){T("info")&&console.log("[EdgeTranslate]",...e)}function b(...e){T("warn")&&console.warn("[EdgeTranslate]",...e)}class _{static create(e){return new Promise(((t,n)=>{chrome.tabs.create(e,(e=>{if(chrome.runtime.lastError)return n(chrome.runtime.lastError.message);t(e)}))}))}static query(e){return new Promise(((t,n)=>{chrome.tabs.query(e,(e=>chrome.runtime.lastError||!e[0]||e[0].id<0?n({error:chrome.runtime.lastError||"The query has no results"}):t(e)))}))}}const A={ach:"ach",ady:"en",af:"af","af-NA":"af","af-ZA":"af",ak:"aka",am:"am",ar:"ar","ar-AR":"ar","ar-MA":"ar","ar-SA":"ar","ay-BO":"aym",az:"az","az-AZ":"az","be-BY":"be",bg:"bg","bg-BG":"bg",bn:"bn","bn-IN":"bn","bn-BD":"bn","bs-BA":"bs",ca:"ca","ca-ES":"ca",cak:"en",ceb:"ceb","ck-US":"chr",co:"co",cs:"cs","cs-CZ":"cs",cy:"cy","cy-GB":"cy",da:"da","da-DK":"da",de:"de","de-AT":"de","de-DE":"de","de-CH":"de",dsb:"en",el:"el","el-GR":"el",en:"en","en-GB":"en","en-AU":"en","en-CA":"en","en-IE":"en","en-IN":"en","en-PI":"en","en-UD":"en","en-US":"en","en-ZA":"en","en@pirate":"en",eo:"eo","eo-EO":"eo",es:"es","es-AR":"es","es-419":"es","es-CL":"es","es-CO":"es","es-EC":"es","es-ES":"es","es-LA":"es","es-NI":"es","es-MX":"es","es-US":"es","es-VE":"es",et:"et","et-EE":"et",eu:"eu","eu-ES":"eu",fa:"fa","fa-IR":"fa","fb-LT":"en",ff:"en",fi:"fi","fi-FI":"fi","fo-FO":"fao",fr:"fr","fr-CA":"fr","fr-FR":"fr","fr-BE":"fr","fr-CH":"fr","fy-NL":"fy",ga:"ga","ga-IE":"ga",gd:"gd",gl:"gl","gl-ES":"gl","gn-PY":"grn","gu-IN":"gu","gx-GR":"el",ha:"ha",haw:"haw",he:"he","he-IL":"he",hi:"hi","hi-IN":"hi",hmn:"hmn",hr:"hr","hr-HR":"hr",hsb:"en",ht:"ht",hu:"hu","hu-HU":"hu","hy-AM":"hy",id:"id","id-ID":"id",ig:"ig",is:"is","is-IS":"is",it:"it","it-IT":"it",iw:"he",ja:"ja","ja-JP":"ja","jv-ID":"jw","ka-GE":"ka","kk-KZ":"kk",km:"km","km-KH":"km",kab:"kab",kn:"kn","kn-IN":"kn",ko:"ko","ko-KR":"ko","ku-TR":"ku",ky:"ky",la:"la","la-VA":"la",lb:"lb","li-NL":"lim",lo:"lo",lt:"lt","lt-LT":"lt",lv:"lv","lv-LV":"lv",mai:"mai","mg-MG":"mg",mi:"mi",mk:"mk","mk-MK":"mk",ml:"ml","ml-IN":"ml","mn-MN":"mn",mr:"mr","mr-IN":"mr",ms:"ms","ms-MY":"ms",mt:"mt","mt-MT":"mt",my:"my",no:"no",nb:"no","nb-NO":"no",ne:"ne","ne-NP":"ne",nl:"nl","nl-BE":"nl","nl-NL":"nl","nn-NO":"no",ny:"ny",oc:"oci","or-IN":"or",pa:"pa","pa-IN":"pa",pl:"pl","pl-PL":"pl","ps-AF":"ps",pt:"pt","pt-BR":"pt","pt-PT":"pt","qu-PE":"que","rm-CH":"roh",ro:"ro","ro-RO":"ro",ru:"ru","ru-RU":"ru","sa-IN":"san",sd:"sd","se-NO":"sme","si-LK":"si",sk:"sk","sk-SK":"sk",sl:"sl","sl-SI":"sl",sm:"sm",sn:"sn","so-SO":"so",sq:"sq","sq-AL":"sq",sr:"sr","sr-RS":"sr",st:"st",su:"su",sv:"sv","sv-SE":"sv",sw:"sw","sw-KE":"sw",ta:"ta","ta-IN":"ta",te:"te","te-IN":"te",tg:"tg","tg-TJ":"tg",th:"th","th-TH":"th",tl:"fil","tl-PH":"fil",tlh:"tlh",tr:"tr","tr-TR":"tr","tt-RU":"tat",uk:"uk","uk-UA":"uk",ur:"ur","ur-PK":"ur",uz:"uz","uz-UZ":"uz",vi:"vi","vi-VN":"vi","xh-ZA":"xh",yi:"yi","yi-DE":"yi",yo:"yo",zh:"zh-CN","zh-Hans":"zh-CN","zh-Hant":"zh-TW","zh-CN":"zh-CN","zh-HK":"zh-TW","zh-SG":"zh-CN","zh-TW":"zh-TW","zu-ZA":"zu"},w={blacklist:{urls:{},domains:{"chrome.google.com":!0,extensions:!0}},LayoutSettings:{Resize:!1,RTL:!1,FoldLongContent:!0,SelectTranslatePosition:"TopRight"},languageSetting:{sl:"auto",tl:A[chrome.i18n.getUILanguage()]},OtherSettings:{MutualTranslate:!1,SelectTranslate:!0,TranslateAfterDblClick:!1,TranslateAfterSelect:!1,CancelTextSelection:!1,UseGoogleAnalytics:!1},DefaultTranslator:"GoogleTranslate",DefaultPageTranslator:"GooglePageTranslate",HybridTranslatorConfig:{translators:["BingTranslate","GoogleTranslate"],selections:{originalText:"GoogleTranslate",mainMeaning:"GoogleTranslate",tPronunciation:"GoogleTranslate",sPronunciation:"GoogleTranslate",detailedMeanings:"BingTranslate",definitions:"GoogleTranslate",examples:"GoogleTranslate"}},TranslateResultFilter:{mainMeaning:!0,originalText:!0,tPronunciation:!0,sPronunciation:!0,tPronunciationIcon:!0,sPronunciationIcon:!0,detailedMeanings:!0,definitions:!0,examples:!0},ContentDisplayOrder:["mainMeaning","originalText","detailedMeanings","definitions","examples"],HidePageTranslatorBanner:!1};function S(e,t){for(let n in t)"object"==typeof t[n]&&!(t[n]instanceof Array)&&Object.keys(t[n]).length>0?e[n]?S(e[n],t[n]):e[n]=t[n]:void 0===e[n]&&(e[n]=t[n])}function R(e,t){return new Promise((n=>{if("string"==typeof e)e=[e];else if(void 0===e){e=[];for(let n in t)e.push(n)}chrome.storage.sync.get(e,(s=>{let a=!1;for(let n of e)s[n]||("function"==typeof t&&(t=t(e)),s[n]=t[n],a=!0);a?chrome.storage.sync.set(s,(()=>n(s))):n(s)}))}))}function E(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,s)}return n}function k(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?E(Object(n),!0).forEach((function(t){v(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):E(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function v(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function L(e){R(["DefaultPageTranslator","languageSetting"],w).then((e=>{e.DefaultPageTranslator}))}function O(e){if(e){let t=/.+:\/+([\w.-]+).*/,n=e.match(t);if(n)return n[1]}return""}function N(e){y(e)}const I="X";function C(e,t){chrome.tabs.query({active:!0,currentWindow:!0},(n=>{n&&n[0]&&R("blacklist",w).then((s=>{let a=s.blacklist,r="urls"===e?n[0].url:O(n[0].url);a[e][r]=!0,chrome.storage.sync.set({blacklist:a},(()=>{t(a,n[0].url)}))}))}))}function x(e,t){chrome.tabs.query({active:!0,currentWindow:!0},(n=>{n&&n[0]&&R("blacklist",w).then((s=>{let a=s.blacklist,r="urls"===e?n[0].url:O(n[0].url);a[e][r]&&delete a[e][r],chrome.storage.sync.set({blacklist:a},(()=>{t(a,n[0].url)}))}))}))}function D(e){R("blacklist",w).then((t=>{t.blacklist.domains[O(e)]?(M(["add_url_blacklist","remove_url_blacklist","add_domain_blacklist"]),P(["remove_domain_blacklist"]),chrome.action.setBadgeText({text:I})):t.blacklist.urls[e]?(M(["add_url_blacklist","add_domain_blacklist","remove_domain_blacklist"]),P(["remove_url_blacklist"]),chrome.action.setBadgeText({text:I})):(M(["remove_url_blacklist","remove_domain_blacklist"]),P(["add_url_blacklist","add_domain_blacklist"]),chrome.action.setBadgeText({text:""}))}))}function P(e){e.forEach((e=>{chrome.contextMenus.update(e,{enabled:!0,visible:!0},(()=>{chrome.runtime.lastError&&N(`Chrome runtime error: ${chrome.runtime.lastError}`)}))}))}function M(e){e.forEach((e=>{chrome.contextMenus.update(e,{enabled:!1,visible:!1},(()=>{chrome.runtime.lastError&&N(`Chrome runtime error: ${chrome.runtime.lastError}`)}))}))}const U=["Unable to download","Unable to download all specified images","Image loading failed","Cannot access","before initialization","Extension context invalidated","Canvas error","Network error"],H=[/Cannot access '.*' before initialization/i,/ReferenceError.*before initialization/i,/Unable to download.*images/i];function G(e){if(!e)return"";if("string"==typeof e)return e;if("object"==typeof e&&"string"==typeof e.message)return e.message;try{return String(e)}catch(e){return"[Unserializable Error Object]"}}function j(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,s)}return n}function $(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?j(Object(n),!0).forEach((function(t){z(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):j(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function z(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const F={cacheTtlMs:5e3,redirectDelayMs:10,viewerPath:"web/viewer.html",viewerQuery:{file:"file",source:"source"},downloadDispositionTokens:["attachment"],pdfMimeTypes:["application/pdf","application/x-pdf","text/pdf"],fallbackMimeSniffers:[{mime:"application/octet-stream",hint:"pdf"}],urlHintPatterns:[/\.pdf(?:$|[?#])/i,/\/pdf\/[^/]+/i,/[?&][^=]*\.pdf/i,/\/download[^/]*pdf/i,/\/view[^/]*pdf/i],domainUrlRules:[{domain:/arxiv/i,urlPatterns:[/\/pdf\//i]},{domain:/researchgate/i,urlPatterns:[/\.pdf/i,/\/pdf/i]},{domain:/ieee/i,urlPatterns:[/\/pdf/i]},{domain:/acm/i,urlPatterns:[/\/pdf/i]},{domain:/springer/i,urlPatterns:[/\.pdf/i,/\/pdf/i]},{domain:/sciencedirect/i,urlPatterns:[/\/pdf/i]},{domain:/jstor/i,urlPatterns:[/\.pdf/i]}],navigationSchemes:["http:","https:","file:","ftp:"],enableNetworkProbe:!0,networkProbeTimeoutMs:4e3,networkProbeCacheTtlMs:6e5};function B(e,t){if(!Array.isArray(e)||!t)return"";const n=t.toLowerCase();for(const t of e)if(t&&t.name&&t.name.toLowerCase()===n)return(t.value||"").toString();return""}function K(e,t){const n=e.toLowerCase();return!!n&&(!!t.pdfMimeTypes.some((e=>n.includes(e.toLowerCase())))||t.fallbackMimeSniffers.some((e=>n.includes(e.mime.toLowerCase())&&(!e.hint||n.includes(e.hint.toLowerCase())))))}function q(e){const t=new Map;return{set(n,s){if(!n)return;const a=e?Date.now()+e:0;t.set(n,{value:s,expireAt:a})},get(e){const n=t.get(e);if(n){if(!(n.expireAt&&n.expireAt<=Date.now()))return n.value;t.delete(e)}},clear(){t.clear()}}}function W(e){try{const{protocol:t}=new URL(e);return"http:"===t||"https:"===t}catch(e){return!1}}async function Y(e,t,n,s,a={}){const r=new AbortController,i=setTimeout((()=>r.abort()),n.networkProbeTimeoutMs);try{const s=await fetch(e,{method:t,headers:a,signal:r.signal,redirect:"follow",credentials:"include"});clearTimeout(i);const l=function(e,t){const n=e.get("content-type")||"",s=e.get("content-disposition")||"",a=K(n,t),r=/\.pdf(?:["')]|$)/i.test(s),i=t.downloadDispositionTokens.some((e=>s.toLowerCase().includes(e.toLowerCase())));return{contentType:n,contentDisposition:s,isPdf:a||r,isDownload:i}}(s.headers,n);if("GET"===t)try{var o;await(null===(o=s.body)||void 0===o?void 0:o.cancel())}catch(e){}return $($({},l),{},{status:s.status,ok:s.ok,finalUrl:s.url||e})}catch(n){return clearTimeout(i),"AbortError"!==(null==n?void 0:n.name)&&(null==s||s(`PDF probe ${t} failed for ${e}`,n)),null}}async function J(e,t,n,{logInfo:s,logWarn:a}){if(!("number"!=typeof e||e<0))try{const a=function(e,t){const n=t.viewerQuery.file,s=t.viewerQuery.source,a=chrome.runtime.getURL(t.viewerPath),r=new URLSearchParams;return r.set(n,e),s&&r.set(s,e),`${a}?${r.toString()}`}(t,n);await chrome.tabs.update(e,{url:a}),null==s||s(`PDF redirected: ${t}`)}catch(e){null==a||a("PDF redirect failed",e)}}function V({cache:e,config:t,logInfo:n,logWarn:s,probeCache:a,inflightProbes:r}){var i,o;if(null===(i=chrome)||void 0===i||null===(o=i.webNavigation)||void 0===o||!o.onCommitted||"function"!=typeof chrome.webNavigation.onCommitted.addListener)return{dispose:()=>{},ok:!1};const l=async i=>{try{if(0!==i.frameId||"string"!=typeof i.url)return;const{url:o,tabId:l}=i;try{const e=new URL(o).protocol;if(e&&!t.navigationSchemes.includes(e))return}catch(e){}let c=!0;const h=e.get(o);let u=!0===(null==h?void 0:h.isPdf);if(h)(!1===h.isPdf||h.isDownload)&&(c=!1);else if(t.enableNetworkProbe&&W(o)){const i=await async function(e,t){const n=t.probeCache.get(e);if(n)return n;const s=t.inflightProbes.get(e);if(s)return s;const a=(async()=>{const n=await async function(e,{config:t,logWarn:n}){if(!t.enableNetworkProbe||!W(e))return{isPdf:!0,isDownload:!1,contentType:"",finalUrl:e};const s=await Y(e,"HEAD",t,n);if(s){if(s.isDownload)return $($({},s),{},{isPdf:!1});if(s.isPdf)return s;if(s.ok&&s.status<400)return $($({},s),{},{isPdf:!1})}const a=await Y(e,"GET",t,n,{Range:"bytes=0-0"});return a?a.isDownload?$($({},a),{},{isPdf:!1}):a.isPdf?a:$($({},a),{},{isPdf:!1}):{isPdf:!1,isDownload:!1,contentType:"",finalUrl:e}}(e,{config:t.config,logWarn:t.logWarn})||{isPdf:!1,isDownload:!1,contentType:"",finalUrl:e};return t.probeCache.set(e,n),t.inflightProbes.delete(e),n})();return t.inflightProbes.set(e,a),a}(o,{probeCache:a,inflightProbes:r,config:t,logWarn:s});i?(e.set(o,{isPdf:!!i.isPdf,isDownload:!!i.isDownload,contentType:i.contentType||""}),u=!0===i.isPdf,i.isPdf&&!i.isDownload||(c=!1,i.isDownload&&(null==n||n(`PDF download detected via probe and skipped: ${o}`)))):c=!1}if(!c)return;if(!u&&!function(e,t){return function(e,t){return!(!e||"string"!=typeof e)&&t.urlHintPatterns.some((t=>{try{return t.test(e)}catch(e){return!1}}))}(e,t)||function(e,t){const n=function(e){try{return new URL(e).hostname||""}catch(t){const n=e.match(/\/\/([^/]+)/);return n?n[1]:""}}(e).toLowerCase();return!!n&&t.domainUrlRules.some((t=>{try{var s,a;return!(null==t||null===(s=t.domain)||void 0===s||!s.test(n))&&(null===(a=t.urlPatterns)||void 0===a?void 0:a.some((t=>t.test(e))))}catch(e){return!1}}))}(e,t)}(o,t))return;await J(l,o,t,{logInfo:n,logWarn:s})}catch(e){null==s||s("webNavigation PDF detection failed",e)}};try{return chrome.webNavigation.onCommitted.addListener(l),{ok:!0,dispose:()=>{try{chrome.webNavigation.onCommitted.removeListener(l)}catch(e){}}}}catch(e){return null==s||s("webNavigation unavailable for PDF detection",e),{ok:!1,dispose:()=>{}}}}var X;!function({logWarn:e}={}){!function(e){if(!e)return;const t=Array.isArray(e)?e:[e];for(const e of t)"string"==typeof e&&e.trim()&&m.add(e)}(U),function(e){if(!e)return;const t=Array.isArray(e)?e:[e];for(const e of t)e instanceof RegExp&&g.push(e)}(H),function(){const e=console.error;console.error=function(...t){f(function(e){try{return e.map((e=>{if("string"==typeof e)return e;if(e&&e.message)return e.message;try{return JSON.stringify(e)}catch(t){try{return Object.prototype.toString.call(e)}catch(e){return"[Unknown Object]"}}})).join(" ").trim()}catch(t){return e.map((e=>{try{return String(e)}catch(e){return"[Unserializable Object]"}})).join(" ").trim()}}(t))||e.apply(console,t)}}();(function(e){if("undefined"==typeof window||"function"!=typeof window.addEventListener)return()=>{};const t=e=>{try{if(f(G(null==e?void 0:e.error))){try{var t;null===(t=e.preventDefault)||void 0===t||t.call(e)}catch(e){}return!1}}catch(e){}},n=t=>{try{const s=G(null==t?void 0:t.reason);if(f(s)){null==e||e("Filtered Promise rejection",s);try{var n;null===(n=t.preventDefault)||void 0===n||n.call(t)}catch(e){}return!1}}catch(e){}};window.addEventListener("error",t),window.addEventListener("unhandledrejection",n)})(e),function(e){if("undefined"==typeof self||"function"!=typeof self.addEventListener)return()=>{};const t=t=>{try{const s=G(null==t?void 0:t.error);if(f(s)){null==e||e("Service Worker error filtered",s);try{var n;null===(n=t.preventDefault)||void 0===n||n.call(t)}catch(e){}return!1}}catch(e){}},n=t=>{try{const s=G(null==t?void 0:t.reason);if(f(s)){null==e||e("Service Worker rejection filtered",s);try{var n;null===(n=t.preventDefault)||void 0===n||n.call(t)}catch(e){}return!1}}catch(e){}};self.addEventListener("error",t),self.addEventListener("unhandledrejection",n)}(e)}({logWarn:b}),function(){if("undefined"!=typeof self&&!self.__edgeTranslateMocksInitialized){self.__edgeTranslateMocksInitialized=!0;class t{constructor(e="div"){this.tagName=e.toUpperCase(),this.nodeName=e.toUpperCase(),this.nodeType=1,this.children=[],this.childNodes=[],this.attributes=new Map,this.textContent="",this.innerHTML="",this.outerHTML="",this.className="",this.id="",this.parentNode=null,this.style={}}setAttribute(e,t){this.attributes.set(e,t)}getAttribute(e){return this.attributes.get(e)||null}removeAttribute(e){this.attributes.delete(e)}appendChild(e){return e&&"object"==typeof e&&(this.children.push(e),this.childNodes.push(e),e.parentNode=this),e}removeChild(e){const t=this.children.indexOf(e);return t>-1&&(this.children.splice(t,1),this.childNodes.splice(t,1),e.parentNode=null),e}addEventListener(){}removeEventListener(){}dispatchEvent(){}click(){}focus(){}blur(){}}if(self.MockElement=t,"undefined"==typeof Audio&&(self.Audio=class{constructor(e){this.src=e||"",this.currentTime=0,this.duration=0,this.paused=!0,this.ended=!1,this.volume=1,this.muted=!1}play(){return this.paused=!1,Promise.resolve()}pause(){this.paused=!0}load(){}addEventListener(){}removeEventListener(){}}),"undefined"==typeof Image&&(self.Image=class extends EventTarget{constructor(e,t){super(),this.width=e||0,this.height=t||0,this.complete=!0,this.naturalWidth=e||100,this.naturalHeight=t||100,this._src="",this._onload=null,this._onerror=null,this.crossOrigin=null,this.loading="auto",this.referrerPolicy="",this.decode=()=>Promise.resolve()}set src(e){this._src=e,this.complete=!1,setTimeout((()=>{this.complete=!0,this.naturalWidth=this.width||100,this.naturalHeight=this.height||100;const e=new Event("load");this.dispatchEvent(e),this._onload&&this._onload(e),this.onload&&this.onload(e)}),1)}get src(){return this._src}set onload(e){this._onload=e}get onload(){return this._onload}set onerror(e){this._onerror=e}get onerror(){return this._onerror}addEventListener(e,t){super.addEventListener(e,t)}removeEventListener(e,t){super.removeEventListener(e,t)}}),"undefined"==typeof DOMParser&&(self.DOMParser=class{parseFromString(t,n="text/html"){const s=e("document");if(s.documentElement=e("html"),s.head=e("head"),s.body=e("body"),s.documentElement.appendChild(s.head),s.documentElement.appendChild(s.body),s.appendChild(s.documentElement),"text/html"===n&&t.includes("rich_tta")){const t=e("div");t.id="rich_tta",t.setAttribute("data-iid","mock-iid-value"),s.body.appendChild(t)}return s.getElementById=function(e){return function e(t,n){if(t.id===n)return t;if(t.children)for(let s of t.children){const t=e(s,n);if(t)return t}return null}(this,e)},s.querySelector=self.document.querySelector,s.querySelectorAll=self.document.querySelectorAll,s.createElement=self.document.createElement,s.createTextNode=self.document.createTextNode,s}}),"undefined"==typeof document&&(self.document=e("document"),self.document.documentElement=e("html"),self.document.head=e("head"),self.document.body=e("body"),self.document.documentElement.appendChild(self.document.head),self.document.documentElement.appendChild(self.document.body),self.document.appendChild(self.document.documentElement),self.document.createElement=function(t){return e(t)},self.document.createTextNode=function(e){return{nodeType:3,nodeName:"#text",textContent:e||"",data:e||"",parentNode:null}},self.document.getElementById=function(e){return e&&"string"==typeof e?function e(t,n){if(!t)return null;if(t.id===n)return t;if(t.children&&Array.isArray(t.children))for(let s of t.children){const t=e(s,n);if(t)return t}return null}(self.document,e):null},self.document.querySelector=function(e){return e&&"string"==typeof e&&e.startsWith("#")?self.document.getElementById(e.slice(1)):null},self.document.querySelectorAll=function(){return[]},self.document.location={origin:"chrome-extension://",pathname:"/background.js",search:"",href:"chrome-extension://background.js",protocol:"chrome-extension:",host:"",hostname:""},self.document.addEventListener=function(){},self.document.removeEventListener=function(){},self.document.createTreeWalker=function(){return{nextNode:()=>null,firstChild:()=>null,parentNode:()=>null}},self.document.toString=function(){return"[object Document]"}),"undefined"==typeof location&&(self.location={origin:"chrome-extension://",pathname:"/background.js",search:"",href:"chrome-extension://background.js",protocol:"chrome-extension:",host:"",hostname:""}),"function"==typeof importScripts&&"undefined"==typeof window){const e=Object.defineProperty;Object.defineProperty=function(...t){return"axios"===t[1]&&t[0]===self?e.call(this,...t):e.apply(this,t)},console.log("[EdgeTranslate] Service Worker 환경 설정 완료 - translators 패키지 호환성 확보")}"undefined"==typeof XMLHttpRequest&&(self.XMLHttpRequest=class extends EventTarget{constructor(){super(),this.readyState=0,this.status=0,this.statusText="",this.responseText="",this.response="",this.responseType="",this.timeout=0,this.withCredentials=!1,this.onreadystatechange=null,this.onload=null,this.onerror=null,this.onabort=null,this.ontimeout=null,this._method="",this._url="",this._async=!0,this._requestHeaders={},this._aborted=!1}static get UNSENT(){return 0}static get OPENED(){return 1}static get HEADERS_RECEIVED(){return 2}static get LOADING(){return 3}static get DONE(){return 4}get UNSENT(){return 0}get OPENED(){return 1}get HEADERS_RECEIVED(){return 2}get LOADING(){return 3}get DONE(){return 4}open(e,t,n=!0){this._method=e.toUpperCase(),this._url=t,this._async=n,this.readyState=1,this._fireReadyStateChange()}setRequestHeader(e,t){if(1!==this.readyState)throw new Error("InvalidStateError");this._requestHeaders[e]=t}send(e=null){if(1!==this.readyState)throw new Error("InvalidStateError");if(this._aborted)return;const t={method:this._method,headers:this._requestHeaders};e&&"GET"!==this._method&&"HEAD"!==this._method&&(t.body=e);const n=new AbortController;t.signal=n.signal,this.timeout>0&&setTimeout((()=>{this._aborted||4===this.readyState||(n.abort(),this._handleTimeout())}),this.timeout),this.readyState=2,this._fireReadyStateChange(),fetch(this._url,t).then((e=>{if(!this._aborted)return this.status=e.status,this.statusText=e.statusText,this.readyState=3,this._fireReadyStateChange(),e.text()})).then((e=>{this._aborted||(this.responseText=e||"",this.response="json"===this.responseType?this._tryParseJSON(e):e,this.readyState=4,this._fireReadyStateChange(),this.onload&&this.onload(new Event("load")))})).catch((e=>{this._aborted||("AbortError"===e.name?this._handleTimeout():(this.status=0,this.statusText="",this.readyState=4,this._fireReadyStateChange(),this.onerror&&this.onerror(new Event("error"))))}))}abort(){this._aborted=!0,this.readyState=4,this._fireReadyStateChange(),this.onabort&&this.onabort(new Event("abort"))}getResponseHeader(){return null}getAllResponseHeaders(){return""}_fireReadyStateChange(){this.onreadystatechange&&this.onreadystatechange(new Event("readystatechange")),this.dispatchEvent(new Event("readystatechange"))}_handleTimeout(){this.status=0,this.statusText="",this.readyState=4,this._fireReadyStateChange(),this.ontimeout&&this.ontimeout(new Event("timeout"))}_tryParseJSON(e){try{return JSON.parse(e)}catch(t){return e}}}),"undefined"==typeof console&&(self.console={log:()=>{},warn:()=>{},error:()=>{},info:()=>{},debug:()=>{},trace:()=>{}}),"undefined"==typeof navigator&&(self.navigator={language:"en-US",languages:["en-US","en"],userAgent:"Mozilla/5.0 (ServiceWorker)",platform:"chrome-extension"}),"undefined"==typeof URL||URL.createObjectURL||(URL.createObjectURL=function(){return`blob:chrome-extension://mock-${Math.random().toString(36).substr(2,9)}`},URL.revokeObjectURL=function(){})}function e(e="div"){const t=new MockElement(e);return t.querySelector=()=>null,t.querySelectorAll=()=>[],t.getElementsByTagName=()=>[],t.getElementsByClassName=()=>[],t.getElementById=()=>null,t.style=new Proxy({},{get:()=>"",set:()=>!0}),t._src="",Object.defineProperty(t,"src",{get(){return this._src||""},set(e){this._src=e,"IMG"!==this.tagName&&"IFRAME"!==this.tagName||setTimeout((()=>{this.onload&&this.onload({type:"load",target:this})}),10)}}),t._href="",Object.defineProperty(t,"href",{get(){return this._href||""},set(e){this._href=e}}),"document"===e.toLowerCase()&&(t.location={origin:"chrome-extension://",pathname:"/background.js",search:"",href:"chrome-extension://background.js"}),t}}(),function({config:e,logInfo:t,logWarn:n}={}){const s=function(e={}){var t,n,s;return $($($({},F),e),{},{viewerQuery:$($({},F.viewerQuery),e.viewerQuery||{}),pdfMimeTypes:e.pdfMimeTypes||F.pdfMimeTypes,fallbackMimeSniffers:e.fallbackMimeSniffers||F.fallbackMimeSniffers,urlHintPatterns:e.urlHintPatterns||F.urlHintPatterns,domainUrlRules:e.domainUrlRules||F.domainUrlRules,downloadDispositionTokens:e.downloadDispositionTokens||F.downloadDispositionTokens,navigationSchemes:e.navigationSchemes||F.navigationSchemes,enableNetworkProbe:null!==(t=e.enableNetworkProbe)&&void 0!==t?t:F.enableNetworkProbe,networkProbeTimeoutMs:null!==(n=e.networkProbeTimeoutMs)&&void 0!==n?n:F.networkProbeTimeoutMs,networkProbeCacheTtlMs:null!==(s=e.networkProbeCacheTtlMs)&&void 0!==s?s:F.networkProbeCacheTtlMs})}(e),a=q(s.cacheTtlMs),r=q(s.networkProbeCacheTtlMs),i=new Map;(function({cache:e,probeCache:t,config:n,logInfo:s,logWarn:a}){var r,i;if(null===(r=chrome)||void 0===r||null===(i=r.webRequest)||void 0===i||!i.onHeadersReceived||"function"!=typeof chrome.webRequest.onHeadersReceived.addListener)return{dispose:()=>{},ok:!1};const o=r=>{try{if(0!==r.frameId||"string"!=typeof r.url)return;const i=r.responseHeaders||[],o=B(i,"content-type"),l=K(o,n),c=function(e,t){const n=B(e,"content-disposition").toLowerCase();return!!n&&t.some((e=>n.includes(e.toLowerCase())))}(i,n.downloadDispositionTokens),h={isPdf:l,isDownload:c,contentType:o};e.set(r.url,h),null==t||t.set(r.url,h),l&&!c?setTimeout((()=>{J(r.tabId,r.url,n,{logInfo:s,logWarn:a})}),n.redirectDelayMs):c&&(null==s||s(`PDF download detected and left untouched: ${r.url}`))}catch(e){null==a||a("webRequest PDF detection failed",e)}};try{chrome.webRequest.onHeadersReceived.addListener(o,{urls:["<all_urls>"],types:["main_frame"]},["responseHeaders"])}catch(e){return null==a||a("webRequest unavailable, falling back to URL-based detection",e),{ok:!1,dispose:()=>{}}}})({cache:a,probeCache:r,config:s,logInfo:t,logWarn:n}),V({cache:a,config:s,logInfo:t,logWarn:n,probeCache:r,inflightProbes:i})}({logInfo:y,logWarn:b});try{var Z,Q;null===(Z=chrome.runtime.onStartup)||void 0===Z||null===(Q=Z.addListener)||void 0===Q||Q.call(Z,(()=>{y("Extension startup")}))}catch(e){}let ee=!1;function te(){if(ee)return;const e=()=>{chrome.contextMenus.create({id:"translate",title:`${chrome.i18n.getMessage("Translate")} '%s'`,contexts:["selection"]}),chrome.contextMenus.create({id:"shortcut",title:chrome.i18n.getMessage("ShortcutSetting"),contexts:["action"]}),chrome.contextMenus.create({id:"add_url_blacklist",title:chrome.i18n.getMessage("AddUrlBlacklist"),contexts:["action"],enabled:!1,visible:!1}),chrome.contextMenus.create({id:"add_domain_blacklist",title:chrome.i18n.getMessage("AddDomainBlacklist"),contexts:["action"],enabled:!1,visible:!1}),chrome.contextMenus.create({id:"remove_url_blacklist",title:chrome.i18n.getMessage("RemoveUrlBlacklist"),contexts:["action"],enabled:!1,visible:!1}),chrome.contextMenus.create({id:"remove_domain_blacklist",title:chrome.i18n.getMessage("RemoveDomainBlacklist"),contexts:["action"],enabled:!1,visible:!1}),ee=!0};try{chrome.contextMenus.removeAll((()=>{chrome.runtime.lastError,e()}))}catch(t){e()}}chrome.runtime.onInstalled.addListener((async e=>{te(),"install"===e.reason?(chrome.tabs.create({url:chrome.i18n.getMessage("WikiLink")}),chrome.notifications&&"function"==typeof chrome.notifications.create&&chrome.notifications.create("data_collection_notification",{type:"basic",iconUrl:chrome.runtime.getURL("icon/icon128.png"),title:chrome.i18n.getMessage("AppName"),message:chrome.i18n.getMessage("DataCollectionNotice")})):"update"===e.reason&&(await new Promise((e=>{chrome.storage.sync.get((t=>{let n=t;S(n,w),chrome.storage.sync.set(n,e)}))})),chrome.storage.sync.get("languageSetting",(e=>{e.languageSetting&&("zh-cn"===e.languageSetting.sl?e.languageSetting.sl="zh-CN":"zh-tw"===e.languageSetting.sl&&(e.languageSetting.sl="zh-TW"),"zh-cn"===e.languageSetting.tl?e.languageSetting.tl="zh-CN":"zh-tw"===e.languageSetting.tl&&(e.languageSetting.tl="zh-TW"),chrome.storage.sync.set(e))})),chrome.notifications&&"function"==typeof chrome.notifications.create&&chrome.notifications.create("update_notification",{type:"basic",iconUrl:chrome.runtime.getURL("icon/icon128.png"),title:chrome.i18n.getMessage("AppName"),message:chrome.i18n.getMessage("ExtensionUpdated")}))})),chrome.runtime.onStartup.addListener((()=>{te()}));const ne=new class{constructor(){this._services=new Map,this._eventManager=new class{constructor(){this._handlerID=1,this._eventToHandlerIDs=new Map,this._handlerIDToHandler=new Map}on(e,t){const n=this._allocHandlerID();this._handlerIDToHandler.set(n,t),this._eventToHandlerIDs.has(e)?this._eventToHandlerIDs.get(e).add(n):this._eventToHandlerIDs.set(e,new Set([n]));let s=!1;return(()=>{s?console.warn("You shouldn't call the canceler more than once!"):(s=!0,this._off(e,n))}).bind(this)}emit(e,t,n){const s=this._eventToHandlerIDs.get(e);if(s)for(const e of s){const s=this._handlerIDToHandler.get(e);s&&s(t,n)}}_allocHandlerID(){for(;this._handlerIDToHandler.has(this._handlerID);)this._handlerID=(this._handlerID+1)%Number.MAX_SAFE_INTEGER;return this._handlerID}_off(e,t){const n=this._eventToHandlerIDs.get(e);n&&n.delete(t),this._handlerIDToHandler.delete(t)}},chrome.runtime.onMessage.addListener(((e,t,n)=>{let s=JSON.parse(e);if(s&&s.type)switch(s.type){case"event":this._eventManager.emit(s.event,s.detail,t),n&&n();break;case"service":{const e=this._services.get(s.service);if(!e)break;return e(s.params,t).then((e=>n&&n(e))),!0}default:console.error(`Unknown message type: ${e.type}`)}else console.error(`Bad message: ${e}`)}).bind(this))}provide(e,t){this._services.set(e,t)}request(e,t){const n=JSON.stringify({type:"service",service:e,params:t});return new Promise(((e,t)=>{chrome.runtime.sendMessage(n,(n=>{chrome.runtime.lastError?t(chrome.runtime.lastError):e(n)}))}))}requestToTab(e,t,n){const s=this._getTabMessageSender();return s?s(e,JSON.stringify({type:"service",service:t,params:n})):Promise.reject("Can not send message to tabs in current context!")}on(e,t){return this._eventManager.on(e,t)}emit(e,t){let n=JSON.stringify({type:"event",event:e,detail:t});chrome.runtime.sendMessage(n,(()=>{chrome.runtime.lastError&&console.error(chrome.runtime.lastError)}))}emitToTabs(e,t,n){const s=this._getTabMessageSender();if(!s)return void console.error("Can not send message to tabs in current context!");"number"==typeof e&&(e=[e]);const a=JSON.stringify({type:"event",event:t,detail:n});for(let t of e)s(t,a).catch((e=>console.error(e)))}_getTabMessageSender(){return chrome.tabs&&chrome.tabs.sendMessage?(e,t)=>new Promise(((n,s)=>{chrome.tabs.sendMessage(e,t,(e=>{chrome.runtime.lastError?s(chrome.runtime.lastError):n(e)}))})):null}},se=new class{constructor(e){this.channel=e,this.config_loader=R(["HybridTranslatorConfig","DefaultTranslator","languageSetting","OtherSettings"],w).then((t=>{this.HYBRID_TRANSLATOR=new d(t.HybridTranslatorConfig,e),this.TRANSLATORS=k({HybridTranslate:this.HYBRID_TRANSLATOR},this.HYBRID_TRANSLATOR.REAL_TRANSLATORS),this.IN_MUTUAL_MODE=t.OtherSettings.MutualTranslate||!1,this.LANGUAGE_SETTING=t.languageSetting,this.DEFAULT_TRANSLATOR=t.DefaultTranslator,setTimeout((()=>{try{this.warmUpTranslators()}catch(e){}}),0)})),this.TTS_SPEED="fast",this.cacheOptions={maxEntries:300,detectTtlMs:6e5,translateTtlMs:18e5,maxKeyTextLength:500,debounceWindowMs:250},this.detectCache=new Map,this.translationCache=new Map,this.inflightDetect=new Map,this.inflightTranslate=new Map,this.lastTranslateKey=null,this.lastTranslateAt=0,this.provideServices(),this.listenToEvents()}clearCaches(){this.detectCache.clear(),this.translationCache.clear()}fnv1aHash32(e){try{let t=2166136261;for(let n=0;n<e.length;n++)t^=e.charCodeAt(n),t=t+((t<<1)+(t<<4)+(t<<7)+(t<<8)+(t<<24))>>>0;return t.toString(16).padStart(8,"0")}catch(e){return"00000000"}}normalizeKeyText(e){if("string"!=typeof e)return"";const t=e.trim().replace(/\s+/g," "),n=this.cacheOptions.maxKeyTextLength;return t.length<=n?t:`${t.slice(0,Math.max(24,Math.floor(n/2)))}__${this.fnv1aHash32(t)}`}makeDetectKey(e){return this.normalizeKeyText(e)}makeTranslateKey(e,t,n,s){return`${s}||${t}||${n}||${this.normalizeKeyText(e)}`}getFromCache(e,t){const n=e.get(t);if(!n)return null;const s=Date.now();return n.expireAt&&n.expireAt<=s?(e.delete(t),null):(e.delete(t),e.set(t,n),n.value)}setCacheEntry(e,t,n,s){try{const a=s?Date.now()+s:0;e.has(t)&&e.delete(t),e.set(t,{value:n,expireAt:a});const r=this.cacheOptions.maxEntries;if(e.size>r){const t=e.keys().next().value;void 0!==t&&e.delete(t)}}catch(e){}}getDetectionFromCache(e){const t=this.makeDetectKey(e);return this.getFromCache(this.detectCache,t)}rememberDetection(e,t){if(!e||!t)return;const n=this.makeDetectKey(e);this.setCacheEntry(this.detectCache,n,t,this.cacheOptions.detectTtlMs)}getTranslationFromCache(e,t,n,s){const a=this.makeTranslateKey(e,t,n,s);return this.getFromCache(this.translationCache,a)}rememberTranslation(e,t,n,s,a){const r=this.makeTranslateKey(e,t,n,s);this.setCacheEntry(this.translationCache,r,a,this.cacheOptions.translateTtlMs)}provideServices(){this.channel.provide("translate",(e=>this.translate(e.text,e.position))),this.channel.provide("translate_text_quiet",(async e=>{await this.config_loader;const t=e&&e.text?e.text:"";if(!t)return Promise.resolve({originalText:"",translatedText:""});let n=e&&e.sl||this.LANGUAGE_SETTING.sl||"auto",s=e&&e.tl||this.LANGUAGE_SETTING.tl;try{const e=this.DEFAULT_TRANSLATOR;let a=this.getTranslationFromCache(t,n,s,e);return a||(a=await this.TRANSLATORS[e].translate(t,n,s),a&&this.rememberTranslation(t,n,s,e,a)),Promise.resolve(a||{originalText:t,translatedText:t})}catch(e){return Promise.resolve({originalText:t,translatedText:t})}})),this.channel.provide("pronounce",(e=>{let t=e.speed;return t||(t=this.TTS_SPEED,this.TTS_SPEED="fast"===t?"slow":"fast"),this.pronounce(e.pronouncing,e.text,e.language,t)})),this.channel.provide("get_available_translators",(e=>Promise.resolve(this.getAvailableTranslators(e)))),this.channel.provide("update_default_translator",(e=>this.updateDefaultTranslator(e.translator))),this.channel.provide("tts_finished",(async e=>{const t=await this.getCurrentTabId();return-1!==t&&this.channel.emitToTabs(t,"pronouncing_finished",e),Promise.resolve()})),this.channel.provide("tts_error",(async e=>{const t=await this.getCurrentTabId();return-1!==t&&this.channel.emitToTabs(t,"pronouncing_error",e),Promise.resolve()}))}async warmUpTranslators(){try{await this.config_loader;const e=new Set;this.DEFAULT_TRANSLATOR&&e.add(this.DEFAULT_TRANSLATOR),this.HYBRID_TRANSLATOR&&this.HYBRID_TRANSLATOR.REAL_TRANSLATORS&&Object.keys(this.HYBRID_TRANSLATOR.REAL_TRANSLATORS).forEach((t=>e.add(t)));const t="a",n=[];for(const s of e){const e=this.TRANSLATORS[s];e&&("function"!=typeof e.updateTokens?"function"!=typeof e.updateTKK?"function"==typeof e.detect&&n.push(Promise.resolve().then((()=>e.detect(t))).catch((()=>{}))):n.push(Promise.resolve().then((()=>e.updateTKK())).catch((()=>{}))):n.push(Promise.resolve().then((()=>e.updateTokens())).catch((()=>{}))))}const s=(e,t)=>Promise.race([e,new Promise((e=>setTimeout(e,t)))]);await s(Promise.allSettled(n),2500)}catch(e){}}listenToEvents(){this.channel.on("translate_page_google",(()=>{})),this.channel.on("language_setting_update",this.onLanguageSettingUpdated.bind(this)),this.channel.on("frame_closed",this.stopPronounce.bind(this)),this.channel.on("stopPronounce",this.stopPronounce.bind(this)),chrome.storage.onChanged.addListener((async(e,t)=>{"sync"===t&&(await this.config_loader,e.HybridTranslatorConfig&&(this.HYBRID_TRANSLATOR.useConfig(e.HybridTranslatorConfig.newValue),this.clearCaches()),e.OtherSettings&&(this.IN_MUTUAL_MODE=e.OtherSettings.newValue.MutualTranslate),e.languageSetting&&(this.LANGUAGE_SETTING=e.languageSetting.newValue,this.clearCaches()),e.DefaultTranslator&&(this.DEFAULT_TRANSLATOR=e.DefaultTranslator.newValue,this.clearCaches(),this.inflightDetect.clear(),this.inflightTranslate.clear()))}).bind(this))}async getCurrentTabId(){let e=-1;const t=await _.query({active:!0,currentWindow:!0});return e=t[0].id,await this.channel.requestToTab(e,"check_availability").catch((async()=>{if(!await new Promise((e=>{/^file:\/\.*/.test(t[0].url)&&confirm(chrome.i18n.getMessage("PermissionRemind"))?(chrome.tabs.create({url:`chrome://extensions/?id=${chrome.runtime.id}`}),e(!1)):e(!0)})))return void(e=-1);const n=chrome.runtime.getURL("content/notice/notice.html");try{const t=(await _.query({url:n}))[0];chrome.tabs.highlight({tabs:t.index}),e=t.id}catch(t){const a=await _.create({url:n,active:!0});await(s=200,new Promise(((e,t)=>{setTimeout((()=>{e()}),s)}))),e=a.id}var s})),e}async detect(e){if(await this.config_loader,!e)return"";const t=this.getDetectionFromCache(e);if(t)return t;const n=this.makeDetectKey(e);if(this.inflightDetect.has(n))return this.inflightDetect.get(n);const s=this.TRANSLATORS[this.DEFAULT_TRANSLATOR].detect(e).then((t=>(t&&this.rememberDetection(e,t),t))).finally((()=>this.inflightDetect.delete(n)));return this.inflightDetect.set(n,s),s}async translate(e,t){await this.config_loader;const n=await this.getCurrentTabId();if(-1===n)return;let s=(new Date).getTime();this.channel.emitToTabs(n,"start_translating",{text:e,position:t,timestamp:s});let a=this.LANGUAGE_SETTING.sl,r=this.LANGUAGE_SETTING.tl;try{if("auto"!==a&&this.IN_MUTUAL_MODE)switch(a=await this.detect(e),a){case this.LANGUAGE_SETTING.sl:r=this.LANGUAGE_SETTING.tl;break;case this.LANGUAGE_SETTING.tl:r=this.LANGUAGE_SETTING.sl;break;default:a="auto",r=this.LANGUAGE_SETTING.tl}const t=this.DEFAULT_TRANSLATOR,i=this.makeTranslateKey(e,a,r,t),o=Date.now();this.lastTranslateKey===i&&(this.lastTranslateAt,this.cacheOptions.debounceWindowMs),this.lastTranslateKey=i,this.lastTranslateAt=o;let l=this.getTranslationFromCache(e,a,r,t);if(!l)if(this.inflightTranslate.has(i))l=await this.inflightTranslate.get(i);else{const n=this.TRANSLATORS[t].translate(e,a,r).then((n=>(n&&this.rememberTranslation(e,a,r,t,n),n))).finally((()=>this.inflightTranslate.delete(i)));this.inflightTranslate.set(i,n),l=await n}let c=a;if("auto"===a)if(l.sourceLanguage&&"auto"!==l.sourceLanguage)c=l.sourceLanguage;else try{const t=await this.detect(e);c=t&&"auto"!==t?t:"en"}catch(e){c="en"}l.sourceLanguage=c,l.targetLanguage=r,l.originalText&&l.originalText===e||(l.originalText=e),this.channel.emitToTabs(n,"translating_finished",k({timestamp:s},l))}catch(e){this.channel.emitToTabs(n,"translating_error",{error:e,timestamp:s})}}async pronounce(e,t,n,s){await this.config_loader;const a=await this.getCurrentTabId();if(-1===a)return;let r=n,i=(new Date).getTime();this.channel.emitToTabs(a,"start_pronouncing",{pronouncing:e,text:t,language:n,timestamp:i});try{"auto"===n&&(r=await this.TRANSLATORS[this.DEFAULT_TRANSLATOR].detect(t)),this.channel.emitToTabs(a,"execute_tts",{pronouncing:e,text:t,language:r,speed:s,timestamp:i,translator:this.DEFAULT_TRANSLATOR})}catch(t){this.channel.emitToTabs(a,"pronouncing_error",{pronouncing:e,error:t,timestamp:i})}}async stopPronounce(){await this.config_loader;const e=await this.getCurrentTabId();-1!==e&&(this.channel.emitToTabs(e,"stop_tts",{timestamp:(new Date).getTime()}),this.channel.emitToTabs(e,"pronouncing_finished",{timestamp:(new Date).getTime(),pronouncing:"both"})),this.TRANSLATORS[this.DEFAULT_TRANSLATOR].stopPronounce()}getAvailableTranslators(e){return this.HYBRID_TRANSLATOR?["HybridTranslate"].concat(this.HYBRID_TRANSLATOR.getAvailableTranslatorsFor(e.from,e.to)):(console.log("HYBRID_TRANSLATOR not initialized yet"),["HybridTranslate"])}async onLanguageSettingUpdated(e){let t=this.DEFAULT_TRANSLATOR,n=this.getAvailableTranslators(e);const s=this.HYBRID_TRANSLATOR.updateConfigFor(e.from,e.to);chrome.storage.sync.set({HybridTranslatorConfig:s}),this.clearCaches(),new Set(n).has(t)||(t=n[1],chrome.storage.sync.set({DefaultTranslator:t})),this.channel.emit("hybrid_translator_config_updated",{config:s,availableTranslators:n.slice(1)}),_.query({active:!0,currentWindow:!0}).then((e=>this.channel.emitToTabs(e[0].id,"update_translator_options",{selectedTranslator:t,availableTranslators:n})))}updateDefaultTranslator(e){return new Promise((t=>{chrome.storage.sync.set({DefaultTranslator:e},(()=>{t()}))}))}}(ne);chrome.notifications&&"function"==typeof(null===(X=chrome.notifications.onClicked)||void 0===X?void 0:X.addListener)&&chrome.notifications.onClicked.addListener((e=>{switch(e){case"update_notification":chrome.tabs.create({url:"https://github.com/EdgeTranslate/EdgeTranslate/releases"});break;case"data_collection_notification":chrome.tabs.create({url:chrome.runtime.getURL("options/options.html#google-analytics")})}})),chrome.contextMenus.onClicked.addListener(((e,t)=>{switch(e.menuItemId){case"translate":ne.requestToTab(t.id,"get_selection").then((({text:e,position:t})=>e?se.translate(e,t):Promise.reject())).catch((t=>e.selectionText.trim()?se.translate(e.selectionText,null):Promise.resolve(t)));break;case"translate_page":L();break;case"translate_page_google":!function(e){_.query({active:!0,currentWindow:!0}).then((t=>{if(t[0]){if((()=>{if("undefined"==typeof navigator||!navigator.userAgent)return!1;const e=navigator.userAgent;return/Safari\//.test(e)&&!/Chrome\//.test(e)&&!/Chromium\//.test(e)&&!/Edg\//.test(e)})()&&chrome.scripting&&chrome.scripting.executeScript){const n=t[0].id;return void chrome.scripting.executeScript({target:{tabId:n,allFrames:!1},files:["google/init.js"],injectImmediately:!0}).then((()=>{e.emitToTabs(n,"start_page_translate",{translator:"google"}),setTimeout((()=>{try{e.emitToTabs(n,"start_dom_page_translate",{})}catch(e){}}),800)})).catch((()=>{try{chrome.tabs.executeScript(n,{file:"google/init.js"},(()=>{e.emitToTabs(n,"start_page_translate",{translator:"google"}),setTimeout((()=>{try{e.emitToTabs(n,"start_dom_page_translate",{})}catch(e){}}),800)}))}catch(t){e.emitToTabs(n,"inject_page_translate",{}),setTimeout((()=>{try{e.emitToTabs(n,"start_dom_page_translate",{})}catch(e){}}),800)}}))}if("undefined"!=typeof chrome&&chrome.scripting&&chrome.scripting.executeScript){const n=t[0].id;chrome.scripting.executeScript({target:{tabId:n},files:["google/init.js"]}).then((()=>{e.emitToTabs(n,"start_page_translate",{translator:"google"}),setTimeout((()=>{try{e.emitToTabs(n,"start_dom_page_translate",{})}catch(e){}}),800)})).catch((t=>{b(`Chrome scripting error: ${t}`),e.emitToTabs(n,"inject_page_translate",{})}))}else try{const n=t[0].id;chrome.tabs.executeScript(n,{file:"google/init.js"},(()=>{e.emitToTabs(n,"start_page_translate",{translator:"google"})}))}catch(n){e.emitToTabs(t[0].id,"inject_page_translate",{})}}}))}(ne);break;case"settings":chrome.runtime.openOptionsPage();break;case"shortcut":chrome.tabs.create({url:"chrome://extensions/shortcuts"});break;case"add_url_blacklist":C("urls",(()=>{M(["add_url_blacklist","add_domain_blacklist","remove_domain_blacklist"]),P(["remove_url_blacklist"])})),chrome.action.setBadgeText({text:I});break;case"remove_url_blacklist":x("urls",(()=>{M(["remove_url_blacklist","remove_domain_blacklist"]),P(["add_url_blacklist","add_domain_blacklist"])})),chrome.action.setBadgeText({text:""});break;case"add_domain_blacklist":C("domains",(()=>{M(["add_url_blacklist","add_domain_blacklist","remove_url_blacklist"]),P(["remove_domain_blacklist"])})),chrome.action.setBadgeText({text:I});break;case"remove_domain_blacklist":x("domains",((e,t)=>{e.urls[t]?(M(["add_url_blacklist","add_domain_blacklist","remove_domain_blacklist"]),P(["remove_url_blacklist"])):(M(["remove_url_blacklist","remove_domain_blacklist"]),P(["add_url_blacklist","add_domain_blacklist"]),chrome.action.setBadgeText({text:""}))}))}})),chrome.tabs.onActivated.addListener((e=>{chrome.tabs.get(e.tabId,(e=>{e.url&&e.url.length>0&&D(e.url)}))})),chrome.tabs.onUpdated.addListener(((e,t,n)=>{n.active&&n.url&&n.url.length>0&&D(n.url)})),ne.on("redirect",((e,t)=>chrome.tabs.update(t.tab.id,{url:e.url}))),ne.on("open_options_page",(()=>chrome.runtime.openOptionsPage())),ne.on("page_translate_event",((e,t)=>{try{e&&"page_moved"===e.event&&"number"==typeof e.distance&&e.distance>0&&ne.emitToTabs(t.tab.id,"page_translate_control",{action:"cancel_dom_fallback"})}catch(e){}ne.emitToTabs(t.tab.id,"page_translate_event",e)})),ne.provide("get_lang",(()=>Promise.resolve({lang:A[chrome.i18n.getUILanguage()]}))),chrome.commands.onCommand.addListener((e=>{"translate_page"===e?L():_.query({active:!0,currentWindow:!0}).then((t=>ne.emitToTabs(t[0].id,"command",{command:e}))).catch((()=>{}))}))})();